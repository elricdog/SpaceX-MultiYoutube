<!DOCTYPE html>
<html lang="en">
<head>
	<title>SpaceX Board</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">	
	<link rel="icon" href="./favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon"/>
	<link type="text/css" rel="stylesheet" href="main.css">
	<link rel="manifest" href="./manifest.webmanifest">
</head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JPZ7LEND3T"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JPZ7LEND3T');
</script>

<!-- Contact form (emailjs.com) -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"/>
<script>
	(function(){
		emailjs.init("user_BjUMLZEqKE9VdA5391rv8");
	})();
</script>	

<body>

<script src="./js/rss-marquee.js"></script>

<!-- Contact -->
<div id="contact" style="visibility:hidden">
	<center>
	<h1>Contact</h1>
	Please, feel free to send any idea to improve this website. We will take in consideration as soon as posible, or later or never.
	</center>
	<br>
	<form id="contact-form">	
        <input type="hidden" name="contact_number">
		<p>
        <label>Name</label>
        <input type="text" name="user_name" size="32" maxlength="32">
		<br>
        <label>Email</label>
        <input type="email" name="user_email" size="64" maxlength="128">
		</p>
        <label>Message</label>
		<div class="contactMessage">
        <textarea class="contactMessageText" name="message" rows="10"></textarea>
		</div>
		<br>
		<center>		
        <input class="myButton" type="submit" value="Send"></input>
		<button id="buttonContactClose" class="myButton">Close</button>
		<br>
		<br>
		<label id="lblContactError" style="color:red;"></label>
	</form>	
	<br>
	<label style="color:yellow;">(Still not work, under development)</label>
	</center>		
</div>

<!-- About Us -->
<div id="aboutus" style="visibility:hidden">
	<center>
	<h1>About Us</h1>
	<p>
	One day we see that browser tabs was not enough to follow Starship evolution...then...
	<br>
	<br>
	Elric and Sworied
	</p>
	<button id="buttonAboutUsClose" class="myButton">Close</button>
	</center>
</div>

<!-- To read local disk files -->
<div id="load" style="visibility:hidden">
	<center>
	<h1>Select a Configuration File</h1>
	<p>
	<input type="file" id="load-file-input"/>
	</p>
	<button id="buttonLoad" class="myButton">Select</button>
	<button id="buttonLoadClose" class="myButton">Close</button>
	</center>
</div>

<!-- OnLoad and Icons -->
<script>
	function fetchHeader(url, wch) {
		try {
			var req=new XMLHttpRequest();
			req.open("HEAD", url, false);
			req.send(null);
			if(req.status== 200){
				return req.getResponseHeader(wch);
			}
			else return false;
		} catch(er) {
			return er.message;
		}
	}
	
	window.onload = function() {
		document.getElementById('contact-form').addEventListener('submit', function(event) {
			event.preventDefault();			
			// generate a five digit number for the contact_number variable
			this.contact_number.value = Math.random() * 100000 | 0;
			// these IDs from the previous steps
			emailjs.sendForm('contact_service', 'contact_form', this)
				.then(function() {
					console.log('SUCCESS!');
					toggleContact();
				}, function(error) {
					console.log('FAILED...', error);
					document.getElementById('lblContactError').innerHTML = 'FAILED(' + error.status +')...' + error.text;
				});
		});
		
		document.getElementById("iconTime").addEventListener ("click", toggleTimeGroups, false);
		document.getElementById("iconContact").addEventListener ("click", toggleContact, false);
		document.getElementById("buttonContactClose").addEventListener ("click", toggleContact, false);				
		document.getElementById("iconAboutUs").addEventListener ("click", toggleAboutUs, false);		
		document.getElementById("buttonAboutUsClose").addEventListener ("click", toggleAboutUs, false);				
		document.getElementById("iconSave").addEventListener ("click", configurationSave, false);		
		document.getElementById("iconLoad").addEventListener ("click", toggleLoad, false);
		document.getElementById("buttonLoadClose").addEventListener ("click", toggleLoad, false);				
		document.getElementById("buttonLoad").addEventListener ("click", configurationLoad, false);
		document.getElementById("iconFullScreen").addEventListener ("click", toggleFullScreen, false);

		const select1 = document.getElementById("selectCH1");
		const select2 = document.getElementById("selectCH2");
		const select3 = document.getElementById("selectCH3");
		const select4 = document.getElementById("selectCH4");
		var event = new Event('change');
		//{"ch1":"SpaceFlight","ch2":"Lab Padre - Nerdle Cam 4K","ch3":"Lab Padre - Sentinel Cam","ch4":"Everyday Astronaut"}
		select1.selectedIndex = indexMatchingText(select1, "SpaceFlight");
		select2.selectedIndex = indexMatchingText(select2, "Lab Padre - Nerdle Cam 4K");
		select3.selectedIndex = indexMatchingText(select3, "Lab Padre - Sentinel Cam");
		select4.selectedIndex = indexMatchingText(select4, "Everyday Astronaut");			
		select1.dispatchEvent(event);
		select2.dispatchEvent(event);
		select3.dispatchEvent(event);
		select4.dispatchEvent(event);
				
		const feedTextScrollUrl = ['https://elricdog.github.io/SpaceX-MultiYoutube/rss.xml'];
        const rssTextScroll = document.getElementById('rssTextScroll');
        new RSSMarquee(feedTextScrollUrl, rssTextScroll, { speed: 1000 } );
			
		var lastModifiedDate = fetchHeader(location.href,'Last-Modified');
		const lastUpdate = document.getElementById("lastUpdate");
		lastUpdate.innerHTML = lastModifiedDate;
	};
		
	function toggleContact() {		
		const contactScreen = document.getElementById('contact');					
		if (contactScreen.style.visibility == "hidden") {
			document.getElementById('lblContactError').innerHTML = "";
			contactScreen.style.visibility = "visible";
		} else {
			contactScreen.style.visibility = "hidden";
		}
	};	
	
	function toggleAboutUs() {		
		const aboutUsScreen = document.getElementById('aboutus');					
		if (aboutUsScreen.style.visibility == "hidden") {
			aboutUsScreen.style.visibility = "visible";
		} else {
			aboutUsScreen.style.visibility = "hidden";
		}
	};	
		
	function toggleTimeGroups() {		
		const groupLOCAL = document.getElementById('groupLOCAL');
		const groupUTC = document.getElementById('groupUTC');
		const groupTIME = document.getElementById('groupTIME');
		if (groupLOCAL.style.visibility == "hidden") {
			groupLOCAL.style.visibility = "visible";
			groupUTC.style.visibility = "visible";
			groupTIME.style.visibility = "visible";			
			groupLOCAL.style.width = "auto";
			groupUTC.style.width = "auto";
			groupTIME.style.width = "auto";
		} else {
			groupLOCAL.style.visibility = "hidden";
			groupUTC.style.visibility = "hidden";
			groupTIME.style.visibility = "hidden";
			groupLOCAL.style.width = "0px";
			groupUTC.style.width = "0px";
			groupTIME.style.width = "0px";
		}
	};
	
	function toggleLoad() {		
		const loadScreen = document.getElementById('load');					
		if (loadScreen.style.visibility == "hidden") {
			loadScreen.style.visibility = "visible";
		} else {
			loadScreen.style.visibility = "hidden";
		}
	};	
	
	function upload(file, fun) {		
		let reader = new FileReader();
		reader.addEventListener('load', function(e) {
	    	let text = e.target.result;	    	
			fun(text);
		});
		reader.readAsText(file);	
	};
	
	function indexMatchingText(ele, text) {
		for (var i=0; i<ele.length;i++) {
			if (ele[i].childNodes[0].nodeValue === text){
				return i;
			}
		}
		return undefined;
	};
	
	function configurationLoad() {
		let file = document.getElementById("load-file-input").files[0];
		if (file === null) return;
		upload(file, function(text) {
			var data = JSON.parse(text);			
			console.log(data);
			
			const select1 = document.getElementById("selectCH1");
			const select2 = document.getElementById("selectCH2");
			const select3 = document.getElementById("selectCH3");
			const select4 = document.getElementById("selectCH4");

			var event = new Event('change');
			select1.selectedIndex = indexMatchingText(select1, data["ch1"]);
			select2.selectedIndex = indexMatchingText(select2, data["ch2"]);
			select3.selectedIndex = indexMatchingText(select3, data["ch3"]);
			select4.selectedIndex = indexMatchingText(select4, data["ch4"]);			
			select1.dispatchEvent(event);
			select2.dispatchEvent(event);
			select3.dispatchEvent(event);
			select4.dispatchEvent(event);
			
			toggleLoad();
		});		
	};
	
	function download(data, filename, type) {
		var file = new Blob([data], {type: type});
		if (window.navigator.msSaveOrOpenBlob) // IE10+
			window.navigator.msSaveOrOpenBlob(file, filename);
		else { // Others
			var a = document.createElement("a"), url = URL.createObjectURL(file);
			a.href = url;
			a.download = filename;
			document.body.appendChild(a);
			a.click();
			setTimeout(function() {
				document.body.removeChild(a);
				window.URL.revokeObjectURL(url);  
			}, 0); 
		}
	};
	
	function configurationSave() {
		const select1 = document.getElementById("selectCH1");
		const select2 = document.getElementById("selectCH2");
		const select3 = document.getElementById("selectCH3");
		const select4 = document.getElementById("selectCH4");
	
		var data = { 
			"ch1":select1.options[select1.selectedIndex].text, 
			"ch2":select2.options[select2.selectedIndex].text, 
			"ch3":select3.options[select3.selectedIndex].text, 
			"ch4":select4.options[select4.selectedIndex].text, 
		};
		download(JSON.stringify(data), "configuration", "text/plain;charset=utf-8");
	};
	
	function toggleFullScreen() {
	
		const middleBar = document.getElementById("Middle-Select-Bar");	
		const select3 = document.getElementById("selectCH3");
		const select4 = document.getElementById("selectCH4");
		
		var doc = window.document;
		var docEl = doc.documentElement;

		var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
		var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

		if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {		
			middleBar.style.visibility = "hidden";			
			middleBar.style.height = "0px";
			select3.style.height = "0px";
			select4.style.height = "0px";
		
			requestFullScreen.call(docEl);
		} else {
			middleBar.style.visibility = "visible";
			middleBar.style.width = "50%";
			middleBar.style.height = "30px";
			select3.style.height = "30px";
			select4.style.height = "30px";
			
			cancelFullScreen.call(doc);
		}
	};
</script>

<!-- 4 views -->
<table style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;">

<tr id="Top-Select-Bar" style="width: 50%; height: 30px;">
	<td style="width: 50%; height: 30px;">
		<table><tr>
			<td>
				<div class="floating-form">
					<select id="selectCH1" class="floating-select" onclick="this.setAttribute('value', this.value);" onchange="document.getElementById('iframeCH1').src = this.options[this.selectedIndex].value" value=""/>
				</div>
			</td>
			<td>
				<div class="rssTextScroll" id="rssTextScroll"></div>
			</td>				
			<td>
				<div title="Last update date & time" class="iconLabel" id="groupLastUpdate">Last Update:<div id="lastUpdate"></div></div>
			</td>
		</tr></table>
	</td>
	<td style="width: 50%; height: 30px;">
		<table><tr>
			<td>
				<div class="floating-form">
					<select id="selectCH2" class="floating-select" onclick="this.setAttribute('value', this.value);" onchange="document.getElementById('iframeCH2').src = this.options[this.selectedIndex].value" value=""/>
				</div>
			</td>
			<td>
				<div title="LOCAL TIME AT BOCACHICA" class="iconLabel" id="groupLOCAL">LOCAL<div id="timeLOCAL">00:00:00</div></div>
			</td>
			<td>
				<div title="UTC TIME" class="iconLabel" id="groupUTC">UTC<div id="timeUTC">00:00:00</div></div>
			</td>
			<td>
				<div title="YOUR CURRENT LOCAL TIME" class="iconLabel" id="groupTIME">TIME<div id="timeTIME">00:00:00</div></div>
			</td>
			<td>
				<div title="Show/Hide the clocks (LOCAL/UTC/YOUR CURRENT TIME)" class="icon" id="iconTime"><img src="Icons/time.png"/></div>
			</td>
			<td>
				<div title="Load saved configuration" class="icon" id="iconLoad"><img src="Icons/load.png"/></div>
			</td>
			<td>
				<div title="Save current configuration" class="icon" id="iconSave"><img src="Icons/save.png"/></div>
			</td>
			<td>
				<div title="You have any comment or idea?" class="icon" id="iconContact"><img src="Icons/contact.png"/></div>
			</td>
			<td>
				<div title="Information about Us and this web site" class="icon" id="iconAboutUs"><img src="Icons/aboutus.png"/></div>
			</td>
			<td>
				<div title="Go to FullScreen" class="icon" id="iconFullScreen"><img src="Icons/fullscreen.png"/></div>
			</td>
	</tr></table>
	</td>
</tr>

<tr style="width: 50%; height: 50%;">
	<td>
		<iframe id="iframeCH1" style="position: relative; height: 100%; width: 100%;" src="" scrolling="yes" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
	</td>
	<td>
		<iframe id="iframeCH2" style="position: relative; height: 100%; width: 100%;" src="" scrolling="yes" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
	</td>
</tr>

<tr id="Middle-Select-Bar" style="width: 50%; height: 30px;">
	<td>
		<div class="floating-form">
			<select id="selectCH3" class="floating-select" onclick="this.setAttribute('value', this.value);" onchange="document.getElementById('iframeCH3').src = this.options[this.selectedIndex].value" value=""/>
		</div>
	</td>
	<td>
		<div class="floating-form">
			<select id="selectCH4" class="floating-select" onclick="this.setAttribute('value', this.value);" onchange="document.getElementById('iframeCH4').src = this.options[this.selectedIndex].value" value=""/>
		</div>
	</td>
</tr>

<tr style="width: 50%; height: 50%;">
	<td>
		<iframe id="iframeCH3" style="position: relative; height: 100%; width: 100%;" src="" scrolling="yes" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
	</td>
	<td>
		<iframe id="iframeCH4" style="position: relative; height: 100%; width: 100%;" src="" scrolling="yes" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
	</td>
</tr>

</table>

<!-- Main Entry Point -->
<script>
const select1 = document.getElementById("selectCH1");
const select2 = document.getElementById("selectCH2");
const select3 = document.getElementById("selectCH3");
const select4 = document.getElementById("selectCH4");

const timeLOCAL = document.getElementById("timeLOCAL");
const timeUTC = document.getElementById("timeUTC");
const timeTIME = document.getElementById("timeTIME");

const channels = {
 "Select one channel":"",
 "SPACEX":"https://www.youtube.com/embed/_qwLHlVjRyw?autoplay=1&mute=0",
 "SpaceFlight":"https://www.youtube.com/embed/n5kVZlnHZ3o?autoplay=1&mute=0",
 "NSF Fleet Cam":"https://www.youtube.com/embed/gnt2wZBg89g?autoplay=1&mute=1",
 "Lab Padre - Nerdle Cam 4K":"https://www.youtube.com/embed/Ky5l9ZxsG9M?autoplay=1&mute=1",
 "Lab Padre - Sapphire Cam":"https://www.youtube.com/embed/dROdPn9Tpxg?autoplay=1&mute=1",
 "Lab Padre - South Padre Island Pearl Beach Cam":"https://www.youtube.com/embed/agmFDeP5u_w?autoplay=1&mute=1",
 "Lab Padre - Predator Cam":"https://www.youtube.com/embed/lTJ9OgcIMSs?autoplay=1&mute=1",
 "Lab Padre - Lab Cam":"https://www.youtube.com/embed/hpqoqJxbNpw?autoplay=1&mute=1",
 "Lab Padre - Launch Pad Cam":"https://www.youtube.com/embed/Z72Au8Px7mM?autoplay=1&mute=1",
 "Lab Padre - Sentinel Cam":"https://www.youtube.com/embed/n5ozYnVQahE?autoplay=1&mute=1",
 "Everyday Astronaut":"https://www.youtube.com/embed/rnmNAlNvr8o?autoplay=1&mute=0",
 "SpaceX Storm (Spanish)":"https://www.youtube.com/embed/39T-NWgFtME?autoplay=1&mute=0",
 "Marcus House":"https://www.youtube.com/embed/v5IV8Jem8Pc?autoplay=1&mute=0",
 "What about it":"https://www.youtube.com/embed/PRqrxqvOItE?autoplay=1&mute=0",
 "NASA Live":"https://www.youtube.com/embed/21X5lGlDOfg?autoplay=1&mute=0",
 "INFORMATION - Boca Chica, TX Weather":"weather.html",
 "INFORMATION - Flight Radar 24":"https://www.flightradar24.com/simple_index.php?lat=25.99&lon=-97.16&z=11&airports=1&label1=callsign&label2=altspeed&label3=tofrom&size=auto",
 "INFORMATION - Road Closures":"https://tfr.faa.gov/tfr2/list.jsp",
 "INFORMATION - Flight Restrictions Zone":"https://tfr.faa.gov/tfr_map_ims/html/ew/scale7/tile_33_61.html",
 "TWITTER - SpaceX":"twitter.html?people=spacex",
 "TWITTER - Elon Musk":"twitter.html?people=elonmusk",
 "TWITTER - Mary (@BocaChicaGal)":"twitter.html?people=BocaChicaGal",
 "TWITTER - Spaceflight Now (@SpaceflightNow)":"twitter.html?people=SpaceflightNow",
 "TWITTER - Everyday Astronaut (@Erdayastronaut)":"twitter.html?people=Erdayastronaut",
 "SPACEX Web":"https://www.spacex.com",
 "SEARCH - Google":"https://www.google.com/search?igu=1&q=SpaceX",
 "SEARCH - Bing":"https://www.bing.com/search?q=SpaceX",
 "3D / VR Model of StarShip":"https://elricdog.github.io/SpaceX-StarShip/VRStarShip/",
};


// Populate selection channels
for (var key in channels) {
    var el = document.createElement("option");
    el.textContent = key;
    el.value = channels[key];
    select1.appendChild(el);
	select2.appendChild(el.cloneNode(true));
	select3.appendChild(el.cloneNode(true));
	select4.appendChild(el.cloneNode(true));
}

// Update Time
function updateDateTime() {
	let d = new Date();
	let currentTimeZoneOffsetInHours = d.getTimezoneOffset() / 60;

	let utc = new Date();
	utc.setHours( utc.getHours() + currentTimeZoneOffsetInHours );
	let local = new Date();
	local.setHours( local.getHours() + currentTimeZoneOffsetInHours - 6 );
	timeLOCAL.innerHTML = local.toLocaleTimeString();
	timeUTC.innerHTML = utc.toLocaleTimeString();
	timeTIME.innerHTML = d.toLocaleTimeString();
}
var intervalId = window.setInterval(function(){
	updateDateTime();
}, 1000);
updateDateTime();

</script>

</body>
</html>
